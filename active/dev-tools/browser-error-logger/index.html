<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>active/dev-tools/browser-error-logger</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>body{padding:2rem} pre code {white-space: pre-wrap;}</style>
</head>
<body>
<div class="container">
  <nav class="mb-4"><a href="/">Megarepo pages</a> / active/dev-tools/browser-error-logger</nav>
  <article>
    <h1 id="browser-error-logger">Browser Error Logger</h1>
<p>A lightweight TypeScript library for capturing JavaScript errors in the browser and sending them to a server endpoint.</p>
<h2 id="features">Features</h2>
<ul>
<li><strong>Automatic Error Capture</strong>: Catches unhandled errors and promise rejections</li>
<li><strong>Batching</strong>: Buffers errors and sends in batches to reduce network requests</li>
<li><strong>Filtering</strong>: Skip specific errors with custom filter functions</li>
<li><strong>Transform</strong>: Modify error data before sending</li>
<li><strong>Manual Logging</strong>: Log errors and messages programmatically</li>
<li><strong>TypeScript First</strong>: Full type definitions included</li>
<li><strong>Zero Dependencies</strong>: Only uses browser APIs</li>
</ul>
<h2 id="installation">Installation</h2>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>browser-error-logger
</code></pre></div>

<p>Or for local development:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>link<span class="w"> </span>/path/to/browser-error-logger
</code></pre></div>

<h2 id="usage">Usage</h2>
<h3 id="basic-setup">Basic Setup</h3>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createErrorLogger</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;browser-error-logger&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createErrorLogger</span><span class="p">({</span>
<span class="w">  </span><span class="nx">endpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://your-server.com/api/errors&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">appName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;MyApp&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">appVersion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Errors are now automatically captured and batched</span>
</code></pre></div>

<h3 id="configuration-options">Configuration Options</h3>
<div class="codehilite"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">ErrorLoggerConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Required</span>
<span class="w">  </span><span class="nx">endpoint</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">              </span><span class="c1">// Server endpoint to send errors</span>

<span class="w">  </span><span class="c1">// Optional</span>
<span class="w">  </span><span class="nx">appName?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">              </span><span class="c1">// Application identifier</span>
<span class="w">  </span><span class="nx">appVersion?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">           </span><span class="c1">// Application version</span>
<span class="w">  </span><span class="nx">captureUnhandled?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span><span class="w">    </span><span class="c1">// Capture window.onerror (default: true)</span>
<span class="w">  </span><span class="nx">capturePromiseRejections?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span><span class="w"> </span><span class="c1">// Capture unhandled rejections (default: true)</span>
<span class="w">  </span><span class="nx">captureConsoleErrors?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span><span class="w"> </span><span class="c1">// Capture console.error (default: false)</span>
<span class="w">  </span><span class="nx">batchSize?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w">            </span><span class="c1">// Max errors before auto-flush (default: 10)</span>
<span class="w">  </span><span class="nx">flushInterval?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w">        </span><span class="c1">// Auto-flush interval in ms (default: 5000)</span>
<span class="w">  </span><span class="nx">headers?</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Custom HTTP headers</span>
<span class="w">  </span><span class="nx">filter</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">ErrorReport</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span><span class="w">  </span><span class="c1">// Filter out errors</span>
<span class="w">  </span><span class="nx">transform</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">ErrorReport</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ErrorReport</span><span class="p">;</span><span class="w"> </span><span class="c1">// Transform errors</span>
<span class="w">  </span><span class="nx">onSuccess</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">errors</span><span class="o">:</span><span class="w"> </span><span class="kt">ErrorReport</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span><span class="w"> </span><span class="c1">// Success callback</span>
<span class="w">  </span><span class="nx">onError</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">reports</span><span class="o">:</span><span class="w"> </span><span class="kt">ErrorReport</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span><span class="w"> </span><span class="c1">// Error callback</span>
<span class="w">  </span><span class="nx">debug?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span><span class="w">               </span><span class="c1">// Log to console (default: false)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="manual-error-logging">Manual Error Logging</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Log an Error object</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">riskyOperation</span><span class="p">();</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="ne">Error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;riskyOperation&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Log a message</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">logMessage</span><span class="p">(</span><span class="s1">&#39;Something unexpected happened&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">currentUser.id</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="force-flush">Force Flush</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Send all buffered errors immediately</span>
<span class="k">await</span><span class="w"> </span><span class="nx">logger</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
</code></pre></div>

<h3 id="cleanup">Cleanup</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Stop capturing and clean up</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</code></pre></div>

<h3 id="filtering-errors">Filtering Errors</h3>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createErrorLogger</span><span class="p">({</span>
<span class="w">  </span><span class="nx">endpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/api/errors&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">report</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Skip ResizeObserver errors</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">report</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;ResizeObserver&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Skip errors from browser extensions</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">report</span><span class="p">.</span><span class="nx">filename</span><span class="o">?</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;chrome-extension://&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="transforming-errors">Transforming Errors</h3>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createErrorLogger</span><span class="p">({</span>
<span class="w">  </span><span class="nx">endpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/api/errors&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">transform</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">report</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="p">...</span><span class="nx">report</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Add custom data</span>
<span class="w">    </span><span class="nx">context</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">...</span><span class="nx">report</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span>
<span class="w">      </span><span class="nx">sessionId</span><span class="o">:</span><span class="w"> </span><span class="kt">getSessionId</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">getCurrentUserId</span><span class="p">(),</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// Sanitize sensitive data</span>
<span class="w">    </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">report.url.replace</span><span class="p">(</span><span class="sr">/token=\w+/</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;token=REDACTED&#39;</span><span class="p">),</span>
<span class="w">  </span><span class="p">}),</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="server-endpoint">Server Endpoint</h2>
<p>The logger sends POST requests with the following payload:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1701234567890-abc123def&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cannot read property &#39;x&#39; of undefined&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;stack&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TypeError: Cannot read property &#39;x&#39; of undefined\n    at ...&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TypeError&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://example.com/app.js&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;lineno&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;colno&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1701234567890</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unhandled&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://example.com/page&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;userAgent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mozilla/5.0 ...&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;appName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MyApp&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;appVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;context&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>Example Express handler:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/errors&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">errors</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">errors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[</span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">appName</span><span class="si">}</span><span class="sb">] </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="kr">type</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Store in database, send to logging service, etc.</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">sendStatus</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="development">Development</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install dependencies</span>
npm<span class="w"> </span>install

<span class="c1"># Build</span>
npm<span class="w"> </span>run<span class="w"> </span>build

<span class="c1"># Run tests</span>
npm<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Watch mode</span>
npm<span class="w"> </span>run<span class="w"> </span>test:watch
</code></pre></div>

<h2 id="license">License</h2>
<p>MIT</p>
  </article>
  <footer class="mt-5"><hr/><p class="small">Generated by scripts/build_pages.py</p></footer>
</div>
</body>
</html>
